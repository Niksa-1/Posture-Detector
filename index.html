<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Posture Detector - Real-time Posture Monitoring</title>
    <meta name="theme-color" content="#3F9AAE">
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect fill='%232b2b2b' width='192' height='192'/><text x='96' y='120' font-size='80' text-anchor='middle' fill='%2300FFFF' font-family='Arial, sans-serif'>ü™ë</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect fill='%232b2b2b' width='192' height='192'/><text x='96' y='120' font-size='80' text-anchor='middle' fill='%2300FFFF' font-family='Arial, sans-serif'>ü™ë</text></svg>">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Posture Checker">
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileColor" content="#2b2b2b">
    <meta name="msapplication-tap-highlight" content="no">
    
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700&display=swap" rel="stylesheet"/>
    <link href="./styles.css" rel="stylesheet">
</head>
<body>
    <!-- Ambient Background Elements -->
    <div class="tropical-blob blob-1"></div>
    <div class="tropical-blob blob-2"></div>
    <div class="tropical-blob blob-3"></div>

    <!-- Top Navigation -->
    <header class="header-glass">
        <div class="header-container">
            <div class="logo-section">
                <div class="logo-icon">
                    <span class="material-symbols-outlined">spa</span>
                </div>
                <h2 class="logo-text">Posture Detector</h2>
            </div>
            <div class="header-actions">
                <span class="user-name-label" style="display:none;"></span>
                <a href="login.html" class="btn-login">Login</a>
            </div>
        </div>
    </header>

    <main class="main-content">
        <!-- Camera Feed and Control Panel -->
        <div class="grid-container">
            <!-- Camera Feed Card -->
            <div class="camera-card glass-panel">
                <div class="camera-container">
                    <!-- Calibration Instructions -->
                    <div id="calibrationInstructions" class="calibration-alert" style="display:none;">
                        <strong>üìê Calibration Mode</strong><br>
                        Sit in your best upright posture and click "Confirm Upright Position" when ready.
                    </div>

                    <!-- Posture Timer Card -->
                    <div id="postureTimer" class="posture-timer-inline" style="display:none;">
                        <div class="posture-warning">
                            <strong>‚ö†Ô∏è Bad Posture Detected</strong><br>
                            <small>Alert in <span id="timerCountdown">15</span>s</small>
                            <div class="timer-progress-bar">
                                <div id="timerProgress" class="timer-progress-fill"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Posture Alert -->
                    <div id="postureAlert" class="posture-alert" style="display:none;">
                        <strong>‚ö†Ô∏è Posture Alert!</strong> Please correct your posture and sit upright.
                        <button class="alert-close" onclick="document.getElementById('postureAlert').style.display='none'">&times;</button>
                    </div>

                    <!-- Video Feed -->
                    <div id="viewer" class="video-viewer">
                        <video id="videoInput" style="position: absolute; left: -9999px;"></video>
                        <canvas id="canvasOutput"></canvas>
                    </div>

                    <!-- Spinner -->
                    <div id="spinner" class="spinner" style="display:none;">
                        <div class="spinner-circle"></div>
                    </div>


                    <audio id="beepSound" src="./warning.mp3" preload="auto" hidden></audio>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="control-panel">
                <div class="glass-panel control-card">
                    <h3 class="control-title">Flow Control</h3>
                    <p class="control-subtitle">Align your spine with our tracking engine.</p>
                    
                    <div class="button-group">
                        <button id="startBtn" class="btn-primary" disabled>
                            <span class="material-symbols-outlined">play_circle</span>
                            Start Tracking
                        </button>
                        <button id="confirmCalibrationBtn" class="btn-secondary" style="display:none;">
                            <span class="material-symbols-outlined">settings_backup_restore</span>
                            Confirm Upright Position
                        </button>
                    </div>
                </div>
                
                <!-- Audio Toggle Card -->
                <div id="audioToggleCard" class="glass-panel mini-stat-card toggle-card" style="cursor: pointer;">
                    <div class="stat-icon" id="audioToggleIcon">
                        <span class="material-symbols-outlined">volume_up</span>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Alert Sound</p>
                        <p class="stat-value" id="audioToggleStatus">On</p>
                    </div>
                </div>

                <!-- Threshold Adjustment Card -->
                <div class="glass-panel mini-stat-card slider-card">
                    <div class="stat-icon">
                        <span class="material-symbols-outlined">tune</span>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Threshold</p>
                        <p class="stat-value"><span id="thresholdValue">40%</span> drop</p>
                        <input id="thresholdSlider" class="slider-input" type="range" min="0.4" max="0.8" step="0.05" value="0.4" aria-label="Posture threshold sensitivity">
                        <p class="stat-helper">Head drop needed before alert</p>
                    </div>
                </div>

                <!-- Session Time Card -->
                <div class="glass-panel mini-stat-card">
                    <div class="stat-icon">
                        <span class="material-symbols-outlined">timer</span>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Session Time</p>
                        <p class="stat-value" id="statTotalTime">00:00:00</p>
                    </div>
                </div>

                <!-- Next Break Card -->
                <div id="nextBreakContainer" class="glass-panel mini-stat-card">
                    <div class="stat-icon break-icon">
                        <span class="material-symbols-outlined">free_breakfast</span>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Next Break</p>
                        <p class="stat-value" id="nextBreakTimer">--</p>
                    </div>
                </div>

            </div>
        </div>

        <!-- Stats Panel -->
        <section id="analyticsSection" class="analytics-container" style="display: none; margin-top: 2rem;">
            <div class="section-header">
                <h3 class="control-title">Real-time Posture Analytics</h3>
                <p class="control-subtitle">Detailed breakdown of your spinal health and habits.</p>
            </div>
        
            <div class="analytics-grid">
                <div class="glass-panel analytics-card">
                    <div class="card-header">
                        <span class="material-symbols-outlined icon-blue">analytics</span>
                        <h4>Daily Quality Score</h4>
                    </div>
                    <div class="score-display">
                        <span id="qualityScoreValue" class="score-number">0%</span>
                        <div class="score-bar-bg">
                            <div id="qualityScoreBar" class="score-bar-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    <p class="card-footer">Ratio of good vs. bad posture today.</p>
                </div>
        
                <div class="glass-panel analytics-card">
                    <div class="card-header">
                        <span class="material-symbols-outlined icon-green">timelapse</span>
                        <h4>Total Tracking</h4>
                    </div>
                    <div class="time-stats">
                        <div class="time-item">
                            <span class="time-label">Active Session:</span>
                            <span id="totalTimeValue" class="time-value">0h 0m</span>
                        </div>
                        <div class="time-item sub">
                            <span class="time-label">Good Posture:</span>
                            <span id="goodTimeValue" class="time-value success">0m</span>
                        </div>
                        <div class="time-item sub">
                            <span class="time-label">Slouched:</span>
                            <span id="badTimeValue" class="time-value danger">0m</span>
                        </div>
                    </div>
                </div>
        
                <div class="glass-panel analytics-card">
                    <div class="card-header">
                        <span class="material-symbols-outlined icon-orange">military_tech</span>
                        <h4>Discipline</h4>
                    </div>
                    <div class="discipline-stats">
                        <div class="stat-row">
                            <span class="stat-label">Longest Streak:</span>
                            <span id="streakValue" class="stat-value">0m</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Total Alerts:</span>
                            <span id="alertCountValue" class="stat-value">0</span>
                        </div>
                    </div>
                    <p class="card-footer" id="disciplineFeedback">Keep it up! Consistency is key.</p>
                </div>
            </div>
        </section>

        <!-- How It Works Section -->
        <div class="section-header">
            <h2 class="section-title">Mastering Your Flow</h2>
            <div class="title-divider"></div>
        </div>

        <div class="steps-grid">
            <div class="step-card glass-panel">
                <div class="step-icon-wrapper">
                    <div class="step-icon">
                        <span class="material-symbols-outlined">center_focus_strong</span>
                    </div>
                </div>
                <h5 class="step-title">1. Align</h5>
                <p class="step-description">Position your device at eye level.</p>
            </div>

            <div class="step-card glass-panel">
                <div class="step-icon-wrapper">
                    <div class="step-icon">
                        <span class="material-symbols-outlined">architecture</span>
                    </div>
                </div>
                <h5 class="step-title">2. Calibrate</h5>
                <p class="step-description">Set your "Ideal Posture" benchmark. This serves as your personalized golden standard.</p>
            </div>

            <div class="step-card glass-panel">
                <div class="step-icon-wrapper">
                    <div class="step-icon">
                        <span class="material-symbols-outlined">water_drop</span>
                    </div>
                </div>
                <h5 class="step-title">3. Flow</h5>
                <p class="step-description">Work naturally. Gentle notifications will nudge you if your posture slips.</p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-brand">
                <div class="footer-logo">
                    <div class="logo-icon-footer">
                        <span class="material-symbols-outlined">spa</span>
                    </div>
                    <h2 class="footer-logo-text">Posture Detector</h2>
                </div>
                <p class="footer-description">
                    Real-time posture analysis platform. Merging precision with mindful well-being.
                    
                    <br><br>Developed in 2026.
                </p>
                
            </div>

            <div class="footer-social">
                <h6 class="footer-heading">Developers</h6>
                <div class="social-links developer-links">
                    <div class="developer-card">
                        <a href="https://github.com/Niksa-1" target="_blank" class="developer-link glass-panel">
                            <span class="social-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.430.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                </svg>
                            </span>
                            <span class="developer-name">Nik≈°a Kuzmaniƒá</span>
                        </a>
                    </div>
                    <div class="developer-card">
                        <a href="https://github.com/ma31n" target="_blank" class="developer-link glass-panel">
                            <span class="social-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.430.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                </svg>
                            </span>
                            <span class="developer-name">Marin Boban</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection"></script>
    <script src="./config.js" ></script>
    <script src="./stats.js" defer></script>
    <script src="./statsUI.js" defer></script>
    <script src="./login.js" defer></script>
    <script src="./index.js" defer></script>
    <script>
        window.addEventListener('load', onTensorFlowReady);
    </script>

    <!-- Break Modal -->
    <div id="breakModal" class="break-modal" style="display: none;">
        <div class="break-modal-content">
            <h2 id="breakTitle" class="break-title">Time for a break!</h2>
            <div class="break-countdown-display">
                <span id="breakCountdown">5:00</span>
            </div>
            <p id="breakReason" class="break-reason">Stand up, stretch, and rest your eyes</p>
            <button onclick="closeBreakModal(false)" class="btn-skip-break">Skip Break</button>
        </div>
    </div>
</body>
</html>